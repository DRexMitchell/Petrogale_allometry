---
title: "Petrogale phylogenetic analysis"
author: "D. Rex Mitchell"
date: "2023-05-03"
output: html_document
---

IMPORT PACKAGES
```{r}
library(geomorph)
library(phytools)
```

IMPORT DATA
```{r}
load("Petrogale_phylogenetic.rda")
```

PERFORM PROCRUSTES SUPERIMPOSITION AND REMOVE ASYMMETRY VARIATION
```{r}
ind <- dimnames(alldata)[[3]]
pet_sym <- bilat.symmetry(alldata, ind=ind, land.pairs = sym, object.sym=T, curves=slide)
```

PERFORM STANDARD GPA TO OBTAIN CRANIAL (CENTROID) SIZES
```{r}
gpa <- gpagen(alldata)
size <- gpa$Csize
```

CALCULATE MEAN SHAPE FOR EACH SPECIES
```{r}
tmp <- aggregate(two.d.array(pet_sym$symm.shape), by=list(species), FUN=mean)
av.data <- arrayspecs(tmp[,-1], k=3, p=150)
dimnames(av.data)[[3]] <- tmp[,1]
remove(tmp)
```

CALCULATE MEAN SIZE FOR EACH SPECIES
```{r}
tmp <- aggregate(size, by=list(species), FUN=mean)
av.size <- as.numeric(tmp[,2])
names(av.size) <- tmp[,1]
remove(tmp)
```

REARRANGE DATA TO MATCH THE ORDER OF THE PHYLOGENY
```{r}
Match <- match(tree$tip.label,dimnames(av.data)[[3]])
av.data.or <- av.data[,,Match]
av.size.or <- av.size[Match]
```

PERFORM PHYLOGENETIC GENERALISED LEAST SQUARES REGRESSION TO ACCOUNT FOR PHYLOGENETIC RELATEDNESS
```{r}
phy <- procD.pgls(av.data.or~log(av.size.or), tree, iter=999);summary(phy)
```

TEST FOR A PHYLOGENETIC SIGNAL OF CRANIAL SIZE
```{r}
ps <- physignal(av.size.or, tree, iter=999); ps
```

PLOT SIZE-CALIBRATED PHYLOGENY
```{r}
av <- round(av.size.or, digits=0)
obj <- contMap(tree, av, legend=FALSE)
plot(obj)
map2 <- setMap(obj, invert=T)
plot(map2, legend=F)
```